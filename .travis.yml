language: python
cache: pip

python:
  - 3.4
  - 3.5
  - 3.6
  - 3.7-dev
  - pypy3.3-5.2-alpha1

env:
  - TOXENV=py

matrix:
  allow_failures:
    - python: 3.7-dev
  include:
    - python: 3.6
      env: TOXENV=flake8
    - python: 3.6
      env: TOXENV=docs
    - os: osx
      language: generic
      env: TOXENV=py
      before_install:
        - brew update
        - brew install python3
        - virtualenv env -p python3
        - source env/bin/activate
    - # Run tests with optional dependencies:
      python: 3.6
      after_install:
        - echo click_repl >> requirements.txt
      env: TOXENV=py EXTRAS=click_repl
    - # Run tests with incompatible test dependencies:
      python: 3.6
      after_install:
        - echo pyicu >> requirements.txt
      env: TOXENV=py EXTRAS=pyicu

addons:
  apt:
    packages:
      - language-pack-de

install:
  - pip install tox codecov

script:
  - tox

after_script:
  - codecov

after_success:
  - pip install wheel twine
  - python setup.py sdist bdist_wheel
  - test -n $TRAVIS_TAG && twine upload -u $PYPI_USERNAME -p $PYPI_PASSWORD dist/*

deploy:
  - provider: releases
    api_key:
      secure: g60yeYa+BX7XCe7L4mpV5NiaCPkuJzxk+PP3rL/durPF/CudWW2xUuTCLf30WwfrYBg3bJCQKNnzOpL8+d4Maly3UqquDFjK58Z/JBFw6erzg/RAxAnfJzFbWy2mgqKTpBHaDdRnhVtqp23Ov1I/+Jb51DIhij6ILNgGxW1OP8Y=
    file_glob: true
    file: dist/*
    skip_cleanup: true
    on:
      tags: true
    distributions: "sdist bdist_wheel"
